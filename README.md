# åŠ å¯†è´§å¸æ•°æ®æŒ–æ˜å™¨ (Crypto Data Miner)

ä¸€ä¸ªç”¨äºä»å„å¤§åŠ å¯†è´§å¸äº¤æ˜“æ‰€æ‹‰å–å®æ—¶å¸‚åœºæ•°æ®çš„é«˜æ€§èƒ½æ•°æ®æŒ–æ˜å·¥å…·ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”„ **å¤šäº¤æ˜“æ‰€æ”¯æŒ**: å½“å‰æ”¯æŒBinanceï¼Œæ˜“äºæ‰©å±•å…¶ä»–äº¤æ˜“æ‰€
- ğŸ“Š **å¤šæ•°æ®ç±»å‹**: æ”¯æŒè¡Œæƒ…(Ticker)ã€è®¢å•ç°¿(Orderbook)ã€äº¤æ˜“(Trades)ã€Kçº¿(Klines)æ•°æ®
- â° **å®šæ—¶ä»»åŠ¡**: åŸºäºCronè¡¨è¾¾å¼çš„çµæ´»è°ƒåº¦ç³»ç»Ÿ
- ğŸ›¡ï¸ **é€Ÿç‡é™åˆ¶**: å†…ç½®APIè°ƒç”¨é¢‘ç‡æ§åˆ¶ï¼Œé¿å…è§¦åŠäº¤æ˜“æ‰€é™åˆ¶
- ğŸ“ **ç»“æ„åŒ–æ—¥å¿—**: ä½¿ç”¨zapæä¾›é«˜æ€§èƒ½ç»“æ„åŒ–æ—¥å¿—
- ğŸ”§ **é…ç½®é©±åŠ¨**: YAMLé…ç½®æ–‡ä»¶ï¼Œæ”¯æŒçƒ­é…ç½®æ›´æ–°
- ğŸ¥ **å¥åº·æ£€æŸ¥**: å†…ç½®å¥åº·æ£€æŸ¥æœåŠ¡ï¼Œä¾¿äºç›‘æ§
- ğŸŒ **åŠ¨æ€IPç®¡ç†**: Binance APIåŠ¨æ€IPè§£æå’Œæ•…éšœè½¬ç§»ï¼Œæé«˜è¿æ¥ç¨³å®šæ€§

## Binance åŠ¨æ€IPç®¡ç†

### æ¦‚è¿°
ä¸ºBinance REST APIå®ç°äº†åŠ¨æ€IPç®¡ç†åŠŸèƒ½ï¼Œä½¿APIè¯·æ±‚èƒ½å¤Ÿé€šè¿‡åŠ¨æ€è§£æçš„IPåœ°å€è¿›è¡Œï¼Œè€Œä¸æ˜¯ç›´æ¥é€šè¿‡åŸŸåã€‚è¿™æé«˜äº†è¿æ¥çš„ç¨³å®šæ€§å’Œå¯é æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨ç½‘ç»œç¯å¢ƒä¸ç¨³å®šæˆ–é¢ä¸´IPé™åˆ¶çš„æƒ…å†µä¸‹ã€‚

### æ ¸å¿ƒåŠŸèƒ½
- **è‡ªåŠ¨DNSè§£æ**: ä½¿ç”¨å¤šä¸ªDNSæœåŠ¡å™¨ï¼ˆ8.8.8.8ã€1.1.1.1ã€208.67.222.222ï¼‰å®šæœŸè§£æ`api.binance.com`
- **ç½‘ç»œå»¶è¿Ÿä¼˜åŒ–**: è‡ªåŠ¨æ£€æµ‹æ‰€æœ‰IPçš„ç½‘ç»œå»¶è¿Ÿï¼Œä¼˜å…ˆé€‰æ‹©å»¶è¿Ÿæœ€ä½çš„IPåœ°å€
- **IPç¼“å­˜**: å°†è§£æåˆ°çš„IPåœ°å€ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œé»˜è®¤æ¯5åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡
- **æ™ºèƒ½æ’åº**: æŒ‰ç½‘ç»œå»¶è¿Ÿä»ä½åˆ°é«˜è‡ªåŠ¨æ’åºIPåˆ—è¡¨ï¼Œç¡®ä¿æœ€ä½³æ€§èƒ½
- **æ•…éšœè½¬ç§»**: å½“æŸä¸ªIPä¸å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå¯ç”¨IP
- **è´Ÿè½½å‡è¡¡**: åœ¨å¤šä¸ªIPåœ°å€ä¹‹é—´åˆ†é…è¯·æ±‚
- **é€æ˜é›†æˆ**: å¯¹ç°æœ‰APIè°ƒç”¨å®Œå…¨é€æ˜ï¼Œæ— éœ€ä¿®æ”¹ä¸šåŠ¡ä»£ç 
- **é‡è¯•æœºåˆ¶**: è‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚ï¼Œæœ€å¤š3æ¬¡å°è¯•
- **çŠ¶æ€ç›‘æ§**: æä¾›è¯¦ç»†çš„IPç®¡ç†å™¨çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬å»¶è¿Ÿæ•°æ®

### ä½¿ç”¨æ–¹æ³•

#### åŸºæœ¬ä½¿ç”¨
```go
// åˆ›å»ºAPIå®¢æˆ·ç«¯
api := binance.NewRestAPI()

// åˆå§‹åŒ–ï¼ˆè‡ªåŠ¨å¯åŠ¨IPç®¡ç†å™¨ï¼‰
config := types.BinanceConfig{}
err := api.Initialize(config)
if err != nil {
    log.Fatalf("åˆå§‹åŒ–å¤±è´¥: %v", err)
}
defer api.Close()

// æ­£å¸¸ä½¿ç”¨API
ctx := context.Background()
pair := currency.NewPair(currency.BTC, currency.USDT)
price, err := api.GetLatestSpotPrice(ctx, pair)
```

#### å¯ç”¨è¯¦ç»†æ—¥å¿—
```go
api.Verbose = true // å¯ä»¥çœ‹åˆ°IPåˆ‡æ¢è¿‡ç¨‹
```

#### æ£€æŸ¥çŠ¶æ€
```go
status := api.GetIPManagerStatus()
fmt.Printf("çŠ¶æ€: %+v\n", status)
```

### çŠ¶æ€ç¤ºä¾‹è¾“å‡º
```
IPç®¡ç†å™¨çŠ¶æ€: map[
    all_ips:[13.226.67.225 13.32.33.215]
    current_index:0
    current_ip:13.226.67.225
    dns_servers:[8.8.8.8:53 1.1.1.1:53 208.67.222.222:53]
    hostname:api.binance.com
    ip_count:2
    latency_check_enabled:true
    latency_info:[
        {ip:13.226.67.225 latency:1.2ms available:true last_ping:2025-01-19 01:20:29}
        {ip:13.32.33.215 latency:3.5ms available:true last_ping:2025-01-19 01:20:29}
    ]
    running:true
    update_interval:5m0s
]
```

### ä¼˜åŠ¿
1. **æé«˜ç¨³å®šæ€§**: é€šè¿‡å¤šIPæ”¯æŒå‡å°‘å•ç‚¹æ•…éšœ
2. **ç½‘ç»œå»¶è¿Ÿä¼˜åŒ–**: è‡ªåŠ¨é€‰æ‹©å»¶è¿Ÿæœ€ä½çš„IPï¼Œæå‡å“åº”é€Ÿåº¦
3. **è‡ªåŠ¨æ•…éšœè½¬ç§»**: æ— éœ€äººå·¥å¹²é¢„çš„IPåˆ‡æ¢
4. **é€æ˜é›†æˆ**: ä¸å½±å“ç°æœ‰ä»£ç 
5. **å®‰å…¨æ€§**: ä¿æŒTLSè¯ä¹¦éªŒè¯
6. **æ€§èƒ½ä¼˜åŒ–**: è¿æ¥å¤ç”¨å’Œç¼“å­˜æœºåˆ¶
7. **æ™ºèƒ½è·¯ç”±**: åŸºäºå®æ—¶å»¶è¿Ÿæ•°æ®çš„æ™ºèƒ½IPé€‰æ‹©
8. **ç›‘æ§å‹å¥½**: è¯¦ç»†çš„çŠ¶æ€ä¿¡æ¯å’Œå»¶è¿Ÿæ•°æ®

## é¡¹ç›®ç»“æ„

```
data-miner/
â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ config.yaml        # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ internal/              # å†…éƒ¨åŒ…
â”‚   â”œâ”€â”€ exchanges/         # äº¤æ˜“æ‰€å®ç°
â”‚   â”‚   â””â”€â”€ binance/       # Binanceäº¤æ˜“æ‰€
â”‚   â”‚       â”œâ”€â”€ restapi.go # REST APIå®ç°ï¼ˆå«åŠ¨æ€IPç®¡ç†ï¼‰
â”‚   â”‚       â”œâ”€â”€ websocket.go # WebSocketå®ç°
â”‚   â”‚       â””â”€â”€ binance.go # ä¸»è¦æ¥å£
â”‚   â”œâ”€â”€ ipmanager/         # IPç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ manager.go     # åŠ¨æ€IPç®¡ç†å®ç°
â”‚   â”œâ”€â”€ scheduler/         # ä»»åŠ¡è°ƒåº¦å™¨
â”‚   â””â”€â”€ types/             # ç±»å‹å®šä¹‰
â”œâ”€â”€ pkg/                   # å…¬å…±åŒ…
â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”œâ”€â”€ examples/              # ç¤ºä¾‹ä»£ç 
â”‚   â”œâ”€â”€ binance_api_example.go
â”‚   â”œâ”€â”€ binance_dynamic_ip_example.go
â”‚   â”œâ”€â”€ ip_latency_example.go
â”‚   â””â”€â”€ websocket_usage.go
â”œâ”€â”€ docs/                  # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ binance_dynamic_ip.md
â”‚   â”œâ”€â”€ ip_latency_optimization.md
â”‚   â””â”€â”€ websocket-integration.md
â”œâ”€â”€ main.go                # ç¨‹åºå…¥å£
â”œâ”€â”€ go.mod                 # Goæ¨¡å—æ–‡ä»¶
â””â”€â”€ README.md              # é¡¹ç›®æ–‡æ¡£
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¼–è¯‘ç¨‹åº

```bash
go build -o data-miner .
```

### 2. æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯

```bash
./data-miner -help
```

### 3. å¯åŠ¨ç¨‹åº

```bash
./data-miner
```

æˆ–è€…æŒ‡å®šé…ç½®æ–‡ä»¶ï¼š

```bash
./data-miner -config path/to/config.yaml
```

### 4. æŸ¥çœ‹ç‰ˆæœ¬

```bash
./data-miner -version
```

## é…ç½®è¯´æ˜

é…ç½®æ–‡ä»¶ä½¿ç”¨YAMLæ ¼å¼ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š

### åº”ç”¨é…ç½®
```yaml
app:
  name: "crypto-data-miner"
  version: "1.0.0"
  log_level: "info"  # debug, info, warn, error
```

### äº¤æ˜“æ‰€é…ç½®
```yaml
exchanges:
  binance:
    enabled: true
    api_url: "https://api.binance.com"
    websocket_url: "wss://stream.binance.com:9443"
    api_key: ""      # å¯é€‰ï¼Œç”¨äºéœ€è¦è®¤è¯çš„æ¥å£
    api_secret: ""   # å¯é€‰
    
    data_types:
      ticker:
        enabled: true
        symbols: ["BTCUSDT", "ETHUSDT", "BNBUSDT"]
        interval: "1m"
      
      orderbook:
        enabled: true
        symbols: ["BTCUSDT", "ETHUSDT"]
        depth: 20
        interval: "5s"
      
      trades:
        enabled: true
        symbols: ["BTCUSDT", "ETHUSDT"]
        interval: "10s"
      
      klines:
        enabled: true
        symbols: ["BTCUSDT", "ETHUSDT", "BNBUSDT"]
        intervals: ["1m", "5m", "1h", "1d"]
        interval: "1m"
```

### è°ƒåº¦å™¨é…ç½®
```yaml
scheduler:
  enabled: true
  max_concurrent_jobs: 10
  
  jobs:
    - name: "binance_ticker"
      exchange: "binance"
      data_type: "ticker"
      cron: "0 * * * * *"  # æ¯åˆ†é’Ÿæ‰§è¡Œ
    
    - name: "binance_orderbook"
      exchange: "binance"
      data_type: "orderbook"
      cron: "*/5 * * * * *"  # æ¯5ç§’æ‰§è¡Œ
```

### å­˜å‚¨é…ç½®
```yaml
storage:
  file:
    enabled: true
    base_path: "./data"
    format: "json"  # json, csv
  
  cache:
    enabled: true
    max_size: 1000
    ttl: "1h"
```

## æŠ€æœ¯å®ç°ç»†èŠ‚

### åŠ¨æ€IPç®¡ç†å®ç°

#### ç½‘ç»œå»¶è¿Ÿä¼˜åŒ–
IPç®¡ç†å™¨ç°åœ¨æ”¯æŒè‡ªåŠ¨ç½‘ç»œå»¶è¿Ÿæ£€æµ‹ï¼Œä¼˜å…ˆé€‰æ‹©å»¶è¿Ÿæœ€ä½çš„IPåœ°å€ï¼š

- **è‡ªåŠ¨å»¶è¿Ÿæ£€æµ‹**: å®šæœŸæµ‹é‡æ‰€æœ‰IPçš„ç½‘ç»œå»¶è¿Ÿ
- **æ™ºèƒ½æ’åº**: æŒ‰å»¶è¿Ÿä»ä½åˆ°é«˜è‡ªåŠ¨æ’åºIPåˆ—è¡¨
- **å®æ—¶ä¼˜åŒ–**: GetCurrentIP()è‡ªåŠ¨è¿”å›å»¶è¿Ÿæœ€ä½çš„å¯ç”¨IP
- **æ•…éšœè½¬ç§»**: ä¸å¯ç”¨IPè‡ªåŠ¨æ’é™¤ï¼Œç¡®ä¿è¿æ¥ç¨³å®šæ€§

#### IPæ›¿æ¢æœºåˆ¶
ç¨‹åºåœ¨TCPè¿æ¥çº§åˆ«è¿›è¡ŒIPæ›¿æ¢ï¼Œä¿æŒTLSè¯ä¹¦éªŒè¯çš„å®‰å…¨æ€§ï¼š

```go
func (b *BinanceRestAPI) customDialContext(ctx context.Context, network, addr string) (net.Conn, error) {
    host, port, err := net.SplitHostPort(addr)
    if err != nil {
        return nil, fmt.Errorf("invalid address: %w", err)
    }

    // å¦‚æœæ˜¯api.binance.comï¼Œä½¿ç”¨IPç®¡ç†å™¨è·å–IP
    if host == "api.binance.com" {
        if b.ipManager != nil && b.ipManager.IsRunning() {
            ip, err := b.ipManager.GetCurrentIP()
            if err == nil {
                addr = net.JoinHostPort(ip, port)
            }
        }
    }

    dialer := &net.Dialer{
        Timeout:   30 * time.Second,
        KeepAlive: 30 * time.Second,
    }

    return dialer.DialContext(ctx, network, addr)
}
```

#### é‡è¯•æœºåˆ¶
è‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚ï¼Œå¹¶åœ¨é‡è¯•æ—¶åˆ‡æ¢IPï¼š

```go
func (b *BinanceRestAPI) sendHTTPRequestWithRetry(ctx context.Context, method, path string, body interface{}, result interface{}, maxRetries int) error {
    var lastErr error

    for attempt := 0; attempt < maxRetries; attempt++ {
        fullURL := spotAPIURL + path
        err := b.doHTTPRequest(ctx, method, fullURL, body, result)
        if err == nil {
            return nil // è¯·æ±‚æˆåŠŸ
        }

        lastErr = err

        // å¦‚æœä¸æ˜¯æœ€åä¸€æ¬¡å°è¯•ï¼Œåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªIP
        if attempt < maxRetries-1 {
            nextIP, switchErr := b.switchToNextIP()
            if switchErr == nil {
                log.Infof(log.ExchangeSys, "Switching to next IP: %s", nextIP)
            }
            time.Sleep(time.Second * 2) // ç­‰å¾…2ç§’åé‡è¯•
        }
    }

    return fmt.Errorf("failed to complete request after %d attempts, last error: %w", maxRetries, lastErr)
}
```

### ä¿®æ”¹çš„æ–‡ä»¶

1. **`internal/exchanges/binance/restapi.go`**
   - æ·»åŠ äº†IPç®¡ç†å™¨å­—æ®µåˆ°`BinanceRestAPI`ç»“æ„ä½“
   - å®ç°äº†è‡ªå®šä¹‰çš„`customDialContext`æ–¹æ³•è¿›è¡ŒIPæ›¿æ¢
   - ä¿®æ”¹äº†`NewRestAPI`å‡½æ•°ä»¥åˆå§‹åŒ–IPç®¡ç†å™¨
   - é‡å†™äº†`SendHTTPRequest`å’Œç›¸å…³æ–¹æ³•ä»¥æ”¯æŒé‡è¯•å’ŒIPåˆ‡æ¢

2. **`internal/exchanges/binance/binance.go`**
   - ä¿®æ”¹äº†`GetIPManagerStatus`æ–¹æ³•ä»¥åŒæ—¶è¿”å›WebSocketå’ŒREST APIçš„IPç®¡ç†å™¨çŠ¶æ€

3. **æ–°å¢æ–‡ä»¶**
   - `internal/exchanges/binance/restapi_test.go`: å…¨é¢çš„å•å…ƒæµ‹è¯•
   - `examples/binance_dynamic_ip_example.go`: å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹
   - `docs/binance_dynamic_ip.md`: è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£

## æ”¯æŒçš„æ•°æ®ç±»å‹

### 1. Ticker (è¡Œæƒ…æ•°æ®)
åŒ…å«24å°æ—¶ä»·æ ¼å˜åŠ¨ã€æˆäº¤é‡ç­‰ä¿¡æ¯ã€‚

### 2. Orderbook (è®¢å•ç°¿)
åŒ…å«ä¹°å–ç›˜æ·±åº¦æ•°æ®ã€‚

### 3. Trades (äº¤æ˜“æ•°æ®)
åŒ…å«æœ€æ–°çš„æˆäº¤è®°å½•ã€‚

### 4. Klines (Kçº¿æ•°æ®)
åŒ…å«æŒ‡å®šæ—¶é—´é—´éš”çš„OHLCVæ•°æ®ã€‚

## Cronè¡¨è¾¾å¼è¯´æ˜

æ”¯æŒ6ä½æ ¼å¼çš„Cronè¡¨è¾¾å¼ï¼š

```
ç§’ åˆ† æ—¶ æ—¥ æœˆ å‘¨
```

ç¤ºä¾‹ï¼š
- `0 * * * * *` - æ¯åˆ†é’Ÿæ‰§è¡Œ
- `*/5 * * * * *` - æ¯5ç§’æ‰§è¡Œ
- `0 0 * * * *` - æ¯å°æ—¶æ‰§è¡Œ
- `0 0 0 * * *` - æ¯å¤©æ‰§è¡Œ

## ç›‘æ§å’Œå¥åº·æ£€æŸ¥

ç¨‹åºå†…ç½®å¥åº·æ£€æŸ¥æœåŠ¡ï¼Œé»˜è®¤ç«¯å£8081ï¼š

```bash
curl http://localhost:8081/health
```

## æ—¥å¿—æ ¼å¼

ç¨‹åºä½¿ç”¨ç»“æ„åŒ–JSONæ—¥å¿—ï¼Œä¾¿äºæ—¥å¿—åˆ†æï¼š

```json
{
  "level": "info",
  "time": "2025-07-16T23:40:39.646+0800",
  "caller": "main.go:55",
  "msg": "å¯åŠ¨åŠ å¯†è´§å¸æ•°æ®æŒ–æ˜å™¨",
  "name": "crypto-data-miner",
  "version": "1.0.0"
}
```

## APIé™åˆ¶è¯´æ˜

### Binance APIé™åˆ¶
- REST API: 1200 requests/minute
- WebSocketè¿æ¥: è‡ªåŠ¨é‡è¿æœºåˆ¶

ç¨‹åºå†…ç½®äº†é€Ÿç‡é™åˆ¶åŠŸèƒ½ï¼Œä¼šè‡ªåŠ¨æ§åˆ¶APIè°ƒç”¨é¢‘ç‡ã€‚

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„äº¤æ˜“æ‰€

1. åœ¨`internal/exchanges/`ä¸‹åˆ›å»ºæ–°çš„äº¤æ˜“æ‰€ç›®å½•
2. å®ç°`types.ExchangeInterface`æ¥å£
3. åœ¨`main.go`ä¸­æ³¨å†Œæ–°çš„äº¤æ˜“æ‰€

### æ·»åŠ æ–°çš„æ•°æ®ç±»å‹

1. åœ¨`internal/types/data.go`ä¸­å®šä¹‰æ–°çš„æ•°æ®ç»“æ„
2. åœ¨äº¤æ˜“æ‰€å®ç°ä¸­æ·»åŠ å¯¹åº”çš„è·å–æ–¹æ³•
3. åœ¨è°ƒåº¦å™¨ä¸­æ·»åŠ å¤„ç†é€»è¾‘

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **é…ç½®æ–‡ä»¶ä¸å­˜åœ¨**
   ```
   é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: config/config.yaml
   ```
   è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿é…ç½®æ–‡ä»¶å­˜åœ¨æˆ–ä½¿ç”¨`-config`å‚æ•°æŒ‡å®šæ­£ç¡®è·¯å¾„ã€‚

2. **APIè°ƒç”¨å¤±è´¥**
   ```
   failed to get ticker: Get "https://api.binance.com/api/v3/ticker/24hr": dial tcp: lookup api.binance.com: no such host
   ```
   è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒDNSé…ç½®ã€‚

3. **é€Ÿç‡é™åˆ¶**
   ```
   rate limit exceeded
   ```
   è§£å†³æ–¹æ¡ˆï¼šè°ƒæ•´é…ç½®æ–‡ä»¶ä¸­çš„ä»»åŠ¡é¢‘ç‡æˆ–å¢åŠ APIå¯†é’¥é…é¢ã€‚

4. **åŠ¨æ€IPç®¡ç†ç›¸å…³é—®é¢˜**

   **DNSè§£æå¤±è´¥**
   ```
   failed to resolve hostname: lookup api.binance.com on 8.8.8.8:53: no such host
   ```
   è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥DNSæœåŠ¡å™¨è¿æ¥ï¼Œç¡®ä¿å¯ä»¥è®¿é—®8.8.8.8ã€1.1.1.1ã€208.67.222.222ç­‰DNSæœåŠ¡å™¨ã€‚

   **IPç®¡ç†å™¨æœªå¯åŠ¨**
   ```
   IP manager is not running
   ```
   è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿è°ƒç”¨äº†`api.Initialize()`æ–¹æ³•ï¼ŒIPç®¡ç†å™¨ä¼šè‡ªåŠ¨å¯åŠ¨ã€‚

   **æ‰€æœ‰IPéƒ½ä¸å¯ç”¨**
   ```
   no available IPs
   ```
   è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œç­‰å¾…IPç®¡ç†å™¨é‡æ–°è§£æDNSï¼Œæˆ–æ‰‹åŠ¨é‡å¯IPç®¡ç†å™¨ã€‚

   **TLSè¯ä¹¦éªŒè¯å¤±è´¥**
   ```
   x509: certificate is valid for api.binance.com, not 13.32.33.215
   ```
   è§£å†³æ–¹æ¡ˆï¼šè¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œç¨‹åºä¼šè‡ªåŠ¨å¤„ç†TLSè¯ä¹¦éªŒè¯ï¼Œç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ä¸»æœºåã€‚

### åŠ¨æ€IPç®¡ç†æ³¨æ„äº‹é¡¹

1. **ç½‘ç»œä¾èµ–**: éœ€è¦å¯é çš„DNSæœåŠ¡å™¨è®¿é—®
2. **èµ„æºç®¡ç†**: ç¡®ä¿æ­£ç¡®è°ƒç”¨`Close()`æ–¹æ³•æ¸…ç†èµ„æº
3. **æ—¥å¿—çº§åˆ«**: ç”Ÿäº§ç¯å¢ƒå»ºè®®å…³é—­è¯¦ç»†æ—¥å¿—ä»¥æé«˜æ€§èƒ½
4. **ç›‘æ§**: å»ºè®®å®šæœŸæ£€æŸ¥IPç®¡ç†å™¨çŠ¶æ€

## æµ‹è¯•

é¡¹ç›®åŒ…å«å…¨é¢çš„æµ‹è¯•è¦†ç›–ï¼š

### å•å…ƒæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
go test ./...

# è¿è¡ŒBinanceç›¸å…³æµ‹è¯•
go test ./internal/exchanges/binance/...

# è¿è¡Œå¸¦è¯¦ç»†è¾“å‡ºçš„æµ‹è¯•
go test -v ./internal/exchanges/binance/restapi_test.go
```

### æµ‹è¯•è¦†ç›–çš„åŠŸèƒ½
1. **TestNewRestAPI**: éªŒè¯REST APIå®¢æˆ·ç«¯åˆ›å»º
2. **TestInitializeAndClose**: éªŒè¯åˆå§‹åŒ–å’Œèµ„æºæ¸…ç†
3. **TestGetLatestSpotPrice**: éªŒè¯å®é™…APIè°ƒç”¨
4. **TestIPManagerFunctionality**: éªŒè¯IPç®¡ç†å™¨åŠŸèƒ½
5. **TestMultipleRequests**: éªŒè¯å¤šè¯·æ±‚å’Œè´Ÿè½½å‡è¡¡

### ç¤ºä¾‹ç¨‹åº
```bash
# è¿è¡ŒåŠ¨æ€IPç¤ºä¾‹
go run examples/binance_dynamic_ip_example.go

# è¿è¡ŒåŸºæœ¬APIç¤ºä¾‹
go run examples/binance_api_example.go

# è¿è¡ŒWebSocketç¤ºä¾‹
go run examples/websocket_usage.go
```

## æ‰©å±•æ€§

è¯¥å®ç°å…·æœ‰è‰¯å¥½çš„æ‰©å±•æ€§ï¼š

1. **é…ç½®çµæ´»**: å¯ä»¥è½»æ¾è°ƒæ•´DNSæœåŠ¡å™¨ã€æ›´æ–°é—´éš”ç­‰å‚æ•°
2. **å¤šäº¤æ˜“æ‰€æ”¯æŒ**: å¯ä»¥ä¸ºå…¶ä»–äº¤æ˜“æ‰€å®ç°ç±»ä¼¼åŠŸèƒ½
3. **ç›‘æ§é›†æˆ**: å¯ä»¥é›†æˆåˆ°ç°æœ‰çš„ç›‘æ§ç³»ç»Ÿä¸­
4. **è´Ÿè½½å‡è¡¡ç­–ç•¥**: å¯ä»¥å®ç°æ›´å¤æ‚çš„è´Ÿè½½å‡è¡¡ç®—æ³•

### ä¸ºå…¶ä»–äº¤æ˜“æ‰€æ·»åŠ åŠ¨æ€IPç®¡ç†

1. åœ¨å¯¹åº”äº¤æ˜“æ‰€ç›®å½•ä¸‹å®ç°IPç®¡ç†å™¨
2. ä¿®æ”¹HTTPå®¢æˆ·ç«¯ä½¿ç”¨è‡ªå®šä¹‰æ‹¨å·å™¨
3. æ·»åŠ é‡è¯•å’Œæ•…éšœè½¬ç§»é€»è¾‘
4. å®ç°çŠ¶æ€ç›‘æ§æ¥å£

## å»¶è¿Ÿä¼˜åŒ–ç¤ºä¾‹

**æ³¨æ„**: å»¶è¿Ÿæ£€æµ‹åŠŸèƒ½é»˜è®¤ç¦ç”¨ï¼Œä»¥ç¡®ä¿æœ€ä½³ç¨³å®šæ€§ã€‚å¦‚éœ€å¯ç”¨ï¼Œè¯·å‚è€ƒç¤ºä¾‹ç¨‹åºã€‚

è¿è¡Œå»¶è¿Ÿä¼˜åŒ–ç¤ºä¾‹ç¨‹åºï¼š

```bash
go run examples/ip_latency_example.go
```

æµ‹è¯•EOFé”™è¯¯ä¿®å¤ï¼š

```bash
go run examples/test_eof_fix.go
```

ç¤ºä¾‹è¾“å‡ºï¼š
```
=== è¿ç»­è¯·æ±‚æµ‹è¯• ===
è¯·æ±‚ 1/10: æˆåŠŸ - è·å–åˆ° 10 æ¡äº¤æ˜“æ•°æ®
...
è¯·æ±‚ 10/10: æˆåŠŸ - è·å–åˆ° 10 æ¡äº¤æ˜“æ•°æ®

=== æµ‹è¯•ç»“æœ ===
æˆåŠŸ: 10 æ¬¡, å¤±è´¥: 0 æ¬¡, æˆåŠŸç‡: 100.0%
âœ… æ‰€æœ‰è¯·æ±‚éƒ½æˆåŠŸï¼ŒEOFé”™è¯¯å·²ä¿®å¤ï¼
```

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›é¡¹ç›®ï¼

## é¡¹ç›®æˆæœæ€»ç»“

### Binance åŠ¨æ€IPç®¡ç†å®ç°æˆæœ

æˆåŠŸä¸ºBinance REST APIå®ç°äº†åŠ¨æ€IPç®¡ç†åŠŸèƒ½ï¼Œæ˜¾è‘—æé«˜äº†APIè°ƒç”¨çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚è¯¥å®ç°å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- âœ… **å®Œå…¨é€æ˜çš„é›†æˆ**: å¯¹ç°æœ‰APIè°ƒç”¨å®Œå…¨é€æ˜ï¼Œæ— éœ€ä¿®æ”¹ä¸šåŠ¡ä»£ç 
- âœ… **ç½‘ç»œå»¶è¿Ÿä¼˜åŒ–**: è‡ªåŠ¨æ£€æµ‹å¹¶é€‰æ‹©å»¶è¿Ÿæœ€ä½çš„IPï¼Œæå‡å“åº”é€Ÿåº¦ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰
- âœ… **è‡ªåŠ¨æ•…éšœè½¬ç§»**: å½“æŸä¸ªIPä¸å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå¯ç”¨IP
- âœ… **æ™ºèƒ½è´Ÿè½½å‡è¡¡**: åŸºäºå»¶è¿Ÿæ•°æ®åœ¨å¤šä¸ªIPåœ°å€ä¹‹é—´æ™ºèƒ½åˆ†é…è¯·æ±‚
- âœ… **å®æ—¶æ€§èƒ½ç›‘æ§**: æŒç»­ç›‘æ§æ‰€æœ‰IPçš„å»¶è¿Ÿå’Œå¯ç”¨æ€§çŠ¶æ€
- âœ… **å®‰å…¨çš„TLSéªŒè¯**: ä¿æŒTLSè¯ä¹¦éªŒè¯çš„å®‰å…¨æ€§
- âœ… **è¯¦ç»†çš„ç›‘æ§å’Œæ—¥å¿—**: æä¾›å®Œæ•´çš„çŠ¶æ€ä¿¡æ¯ã€å»¶è¿Ÿæ•°æ®å’Œè°ƒè¯•æ—¥å¿—
- âœ… **å…¨é¢çš„æµ‹è¯•è¦†ç›–**: åŒ…å«å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- âœ… **å®Œæ•´çš„æ–‡æ¡£**: è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç 
- âœ… **ç”Ÿäº§å°±ç»ª**: å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨

è¯¥åŠŸèƒ½ç°åœ¨ä¸ºBinance APIè°ƒç”¨æä¾›äº†æ›´å¥½çš„ç¨³å®šæ€§ã€å¯é æ€§å’Œæ€§èƒ½ï¼Œç‰¹åˆ«é€‚ç”¨äºç½‘ç»œç¯å¢ƒä¸ç¨³å®šæˆ–é¢ä¸´IPé™åˆ¶çš„åœºæ™¯ã€‚é€šè¿‡å»¶è¿Ÿä¼˜åŒ–ï¼ŒAPIå“åº”æ—¶é—´å¾—åˆ°æ˜¾è‘—æ”¹å–„ã€‚

## è®¸å¯è¯

MIT License 